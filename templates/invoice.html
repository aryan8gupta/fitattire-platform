{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FitAttire</title>
  <!-- Favicons -->
  <link href="{% static 'img/logo.png' %}" rel="icon">
  <link href="{% static 'img/logo.png' %}" rel="apple-touch-icon">

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f8f8;
    }

    .invoice-container {
      min-height: 95vh;
      max-width: 600px;
      margin: 10px;
      background-color: #fff;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }

    .section-title {
      background-color: #000000; /* Black */
      color: #FFFF00; /* Yellow */
      text-align: center;
      padding: 10px;
      border-radius: 6px;
      font-size: 18px;
      margin-bottom: 12px;
    }

    .logo {
      display: block;
      margin: 0 auto 10px auto;
      max-height: 80px;
    }

    hr {
      border: none;
      border-top: 1px solid #ccc;
      margin: 12px 0;
    }

    .shop-details,
    .customer-details,
    .invoice-summary {
      font-size: 14px;
      line-height: 1.6;
    }

    .customer-details div {
      margin-bottom: 6px;
    }

    .subheading {
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      margin: 14px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      font-size: 14px;
    }

    th {
      background-color: #f0f0f0;
      text-align: left;
    }

    .strong-hr {
      border: none;
      border-top: 2px solid #000;
      margin: 16px 0 8px;
    }

    .summary-line {
      display: flex;
      justify-content: space-between;
      font-size: 16px;
      margin: 6px 0;
    }

    .summary-line h1 {
      font-size: 20px;
      margin: 0;
    }

    .thank-you {
      text-align: center;
      font-weight: bold;
      margin: 20px 0 10px;
      font-size: 16px;
    }

    .explore-button {
      display: block;
      margin: 0 auto 20px auto;
      background-color: #000000; /* Black */
      color: #FFFF00; /* Yellow */
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }

    @media (min-width: 768px) {
      .invoice-container {
        padding: 24px;
      }

      .section-title {
        font-size: 22px;
      }

      .thank-you {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>

    <div class="invoice-container">
        <div class="section-title">Bill Invoice</div>
      {% if records %}
        <img src="{{business_shop_logo}}" alt="Business Logo" class="logo" id="business-logo">

        <hr>
      
        <div class="shop-details">
            <div id="business-address">Shop Address: {{business_shop_address}}</div>
            <div id="business-name">Shop Name: {{business_shop_name}}</div>
            <div id="business-phone">Phone: +91 {{business_phone}}</div>
        </div>

        {% if records %}
          {% with first_record=records.0 %}
              <div class="section-title" style="margin-top: 10px;">Customer Details</div>
      
              <div class="customer-details">
                  <div id="invoice-id">Invoice ID: {{ first_record.invoice_id }}</div>
                  <div id="invoice-date">Sale Date: {{ first_record.sold_on }}</div>
                  <div id="customer-name">Name: {{ first_record.customer_name }}</div>
                  <div id="customer-phone">Phone: +91 {{ first_record.customer_phone }}</div>
              </div>
          {% endwith %}
        {% endif %}
          <hr>

          <div class="subheading">Service Bill Invoice</div>

          <table id="product-table">
              <thead>
              <tr>
                  <th>Images</th>
                  <th>Product Name</th>
                  <th>Qty</th>
              </tr>
              </thead>
              {% for record in records %}
                <tbody>
                  <tr>
                    <td>
                      {% for img_url in record.product_result_images %}
                        <img src="{{ img_url }}" alt="Product Image" style="height: 60px; margin: 5px; border-radius: 6px;" />
                      {% endfor %}
                    </td>
                    <td>{{ record.product_name }}</td>
                    <td>1</td>
                  </tr>
                </tbody>
              {% endfor %}
          </table>

          <hr class="strong-hr">

          {% comment %} <div class="summary-line">
              <span>Subtotal:</span>
              <span id="subtotal">₹0.00</span>
          </div>

          <div class="summary-line">
              <h1>Total:</h1>
              <h1 id="total">{{ record.total_amount }}</h1>
          </div>

          <hr>

          <div class="summary-line">
              <span>Customer Paid Amount:</span>
              <span id="paid-amount">₹0.00</span>
          </div> {% endcomment %}

          {% if records %}
            {% with record=records.0 %}
              <div class="summary-line">
                <span>Subtotal:</span>
                <span id="subtotal">₹{{ record.original_amount|floatformat:2 }}</span>
              </div>

              <div class="summary-line">
                <span>Discount ({{ record.discount_percentage|default:0 }}%):</span>
                <span id="discount-amount">- ₹{{ record.discounted_amount|floatformat:2 }}</span>
              </div>

              <div class="summary-line">
                <strong>Total Payable:</strong>
                <strong id="total">₹{{ record.total_amount|floatformat:2 }}</strong>
              </div>

              <hr>

              <div class="summary-line">
                <span>Customer Paid:</span>
                <span id="paid-amount">₹{{ record.customer_given_amount|floatformat:2 }}</span>
              </div>

              <div class="summary-line">
                <span>
                  {% if record.less < 0 %}
                    Less: 
                  {% else %}
                    Returned Change: 
                  {% endif %}
                </span>
                <span id="change">₹{{ record.less|floatformat:2 }}</span>
              </div>
              
            {% endwith %}
          {% endif %}


        <div class="thank-you">Thank you for choosing us.</div>

        <hr>

        <button class="explore-button">Explore More Products</button>
      {% else %}
        <p>No records found for this invoice.</p>
      {% endif %}
    </div>

    <script>

    {% comment %} products.forEach((p, i) => {
        const total = p.qty * p.rate;
        subtotal += total;
        const row = document.createElement("tr");
        row.innerHTML = `
        <td>${i + 1}</td>
        <td>${p.name}</td>
        <td>${p.qty}</td>
        <td>₹${p.rate.toFixed(2)}</td>
        <td>₹${total.toFixed(2)}</td>
        `;
        tbody.appendChild(row);
    }); {% endcomment %}

    </script>

</body>
</html>
